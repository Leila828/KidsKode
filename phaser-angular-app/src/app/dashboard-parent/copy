import { Component, OnInit, ViewChild } from "@angular/core";
import { Router } from "@angular/router";
import { NavbarService } from "../navbar.service";
import { TokenStorageService } from "../_services/token-storage.service";
//import { ChartsModule } from "ng2-charts";
import { Chart } from "chart.js";
import { Parent } from "../parent";
import { AuthService } from "../_services/auth.service";
import { UserService } from "../_services/user.service";
import { Child } from "../child";
import { enfantLearning } from "../enfantLearning";
import { BaseChartDirective } from "ng2-charts";

@Component({
  selector: "app-dashboard-parent",
  templateUrl: "./dashboard-parent.component.html",
  styleUrls: ["./dashboard-parent.component.css"],
})
export class DashboardParentComponent implements OnInit {
  @ViewChild(BaseChartDirective) chart: BaseChartDirective;

  private roles: string[] = [];
  isLoggedIn = false;
  showAdminBoard = false;
  score3: number = 0;
  showModeratorBoard = false;
  username?: string;
  id_user;
  parent: Parent;
  User?: Parent;
  child?: enfantLearning;
  chartReady: Boolean = false;
  public barChartOptions = {
    scaleShowVerticalLines: false,
    responsive: true,
  };
  public barChartLabels = [
    "Sequencing",
    "loop",
    "blockly_sequencing",
    "blockly_loop",
    "blockly_condition",

    //   "2003",
    // "2004",
    //"2005",
    //"2006",
  ];
  public barChartType = "bar";
  public bar;
  public barChartData: any[] = [
    {
      data: [0, 0, 0, 0, 0],
      label: "Course Progress ",
    },
  ];
  //  public barChartLegend = true;
  constructor(
    private router: Router,
    public nav: NavbarService,
    private tokenStorageService: TokenStorageService,
    private userauth: UserService
  ) {}

  async ngOnInit() {
    this.nav.hide();
    this.isLoggedIn = !!this.tokenStorageService.getToken();

    const user = this.tokenStorageService.getUser();
    this.roles = user.roles;

    this.showAdminBoard = this.roles.includes("ROLE_ADMIN");
    this.showModeratorBoard = this.roles.includes("ROLE_MODERATOR");

    this.username = user.username;
    this.parent = await this.getparent();
    this.id_user = this.parent.enfant.compte.id;
    this.child = await this.getenfant(this.id_user);
    console.log(this.child);

    setTimeout(() => {
      this.chart.chart.data.datasets[0].data = [
        this.child.points2,
        this.child.points,
        this.child.points_sequencing_blockly,
        this.child.points_loop_blockly,
        this.child.points_condition_blockly,

        100,
      ];
      this.chart.chart.update();
    }, 2000);

    this.chartReady = true;
  }
  //   console.log("lage ta3ah :" + this.child.points);

  getparent(): Promise<Parent> {
    return this.tokenStorageService.getinfo().toPromise();
  }
  getenfant(id: string): Promise<enfantLearning> {
    return this.userauth.getenfantlearning(id).toPromise();
  }

  btnClick() {
    this.router.navigate(["/Dashboard/child"]);
  }
  logout(): void {
    if (this.isLoggedIn) {
      this.tokenStorageService.signOut();
      window.location.reload();
    }
  }
  public chartClicked(e: any): void {}
  public chartHovered(e: any): void {}
}


---------------------------------------------------------------------------





<body
  style="
    background-image: url('https://www.transparenttextures.com/patterns/inspiration-geometry.png');
    background-color: #ffffff;
  "
>
  <div *ngIf="isLoggedIn">
    <div id="sidebar-wrapper">
      <ul class="sidebar-nav">
        <li class="sidebar-brand"></li>
        <li>
          <a href="#">Courses</a>
        </li>
        <li>
          <a href="#">Solutions</a>
        </li>
        <li>
          <a href="#">Challenges</a>
        </li>
      </ul>
    </div>
    <img
      style="position: absolute; width: 400px; right: 0%; top: 10%"
      src="assets/aicha/CodeMonkey-Parent-Image.png"
      alt=""
    />
    <app-navbar2></app-navbar2>
    <!--
    <nav
      style="background-color: black"
      class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"
    >
      <div class="container">
        <a
          class="navbar-brand"
          href="https://mdbootstrap.com/material-design-for-bootstrap/"
          target="_blank"
        >
          <strong>MDB</strong>
        </a>


        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav mr-auto">
            <li class="nav-item active">
              <a class="nav-link">
                <span class="sr-only">(current)</span>
              </a>
            </li>
          </ul>

          <ul style="margin-right: -39px" class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link" [routerLink]="['../../profile']"
                ><img
                  style="height: 30px; width: 30px"
                  src="/assets/aicha/avatarparent.png"
                  alt=""
              /></a>
            </li>

            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                id="navbarDropdown"
                role="button"
                data-toggle="dropdown"
                aria-haspopup="true"
                aria-expanded="false"
              >
                <img src="/assets/aicha/menubtn.png" alt="" />
              </a>
              <div
                style="content: none"
                class="dropdown-menu"
                aria-labelledby="navbarDropdown"
              >
                <a
                  style="
                    font-family: 'Montserrat', sans-serif;
                    font-size: 15px;
                    font-weight: 100;
                  "
                  class="dropdown-item"
                  [routerLink]="['junior']"
                  >KidsKode Junior</a
                >
                <a
                  style="
                    font-family: 'Montserrat', sans-serif;
                    font-size: 15px;
                    font-weight: 100;
                  "
                  class="dropdown-item"
                  [routerLink]="['midlevel']"
                  >Another action</a
                >
              </div>
            </li>
          </ul>
        </div>
      </div>
    </nav>
  -->
    <div class="main">
      <header class="header" style="background-color: #ffffff">
        <h2
          style="
            position: absolute;
            margin-top: -26px;
            margin-left: 76px;
            font-family: 'Amatic SC';
            font-size: xxx-large;
            font-weight: revert;
          "
        >
          hello {{ username }} in your Dashboard !
        </h2>
      </header>
      <div id="child">
        <h3
          style="
            background-color: #ffffff;
            color: #f8de8d;
            margin-bottom: 5px;
            text-transform: uppercase;
            font-size: 20px;
            font-weight: 500;
          "
        >
          PARENT DASHBOARD
        </h3>
        <hr style="color: #f9cf0e; height: 5px; margin-bottom: 10px" />
        <div
          style="
            color: #f9cf0e;
            height: 3px;
            margin-bottom: -6px;
            background-color: #f9cf0e;
            margin-top: -17px;
          "
        ></div>

        <img class="lapin" src="/assets/aicha/avatarparent.png" alt="image" />
        <div class="userdetails child">
          <h4>
            <strong>Child Username</strong>
          </h4>
          <div *ngIf="parent">
            <h6>{{ parent.enfant.compte.username }}</h6>
          </div>
        </div>

        <h6 style="margin-left: 128px">
          <img
            style="height: 15px; width: 15px"
            ng-cdn-src="locales/warning.png"
            class="ng-isolate-scope"
            src="https://d2j5eocv5gptnv.cloudfront.net/assets/locales/warning-a16321f0719391db1dff87f5490b7e247fe4ff5f3968e99d41ba0c9dd143230b.png"
          />
          To start playing, log in to your childâ€™s account.
        </h6>
        <a routerLink="/Dashboard/child" class="button">Child </a>
      </div>
      <div style="width: 683px; height: 310px" id="box">
        <div
          style="
            background-color: #ffffff;
            display: block;
            height: 246px;
            width: 560px;
            margin-top: -33px;
            margin-left: 7px;
          "
          *ngIf="barChartData"
        >
          <canvas
            id="bar"
            height="300"
            width=" 550"
            baseChart
            class="chart"
            [datasets]="barChartData"
            [labels]="barChartLabels"
            [options]="barChartOptions"
            [chartType]="barChartType"
          >
          </canvas>
        </div>
      </div>
      <!-- <button type="button" class="button" (click)="btnClick()">
        Child Dashboard
      </button>-->
    </div>
  </div>
</body>

<!--[legend]="barChartLegend"
-->
--------------------------------------------------------------------------------------------------------------------------------------
old one



<body
  style="
    background-image: url('https://www.transparenttextures.com/patterns/inspiration-geometry.png');
    background-color: #ffffff;
  "
>
<div *ngIf="isLoggedIn">
  <div id="sidebar-wrapper">
    <ul class="sidebar-nav">
      <li class="sidebar-brand"></li>
      <li>
        <a href="#">Courses</a>
      </li>
      <li>
        <a href="#">Solutions</a>
      </li>
      <li>
        <a href="#">Challenges</a>
      </li>
    </ul>
  </div>
  <img
    style="position: absolute; width: 400px; right: 0%; top: 10%"
    src="assets/aicha/CodeMonkey-Parent-Image.png"
    alt=""
  />
  <app-navbar2></app-navbar2>
  <!--
  <nav
    style="background-color: black"
    class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"
  >
    <div class="container">
      <a
        class="navbar-brand"
        href="https://mdbootstrap.com/material-design-for-bootstrap/"
        target="_blank"
      >
        <strong>MDB</strong>
      </a>


      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mr-auto">
          <li class="nav-item active">
            <a class="nav-link">
              <span class="sr-only">(current)</span>
            </a>
          </li>
        </ul>

        <ul style="margin-right: -39px" class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link" [routerLink]="['../../profile']"
              ><img
                style="height: 30px; width: 30px"
                src="/assets/aicha/avatarparent.png"
                alt=""
            /></a>
          </li>

          <li class="nav-item dropdown">
            <a
              class="nav-link dropdown-toggle"
              href="#"
              id="navbarDropdown"
              role="button"
              data-toggle="dropdown"
              aria-haspopup="true"
              aria-expanded="false"
            >
              <img src="/assets/aicha/menubtn.png" alt="" />
            </a>
            <div
              style="content: none"
              class="dropdown-menu"
              aria-labelledby="navbarDropdown"
            >
              <a
                style="
                  font-family: 'Montserrat', sans-serif;
                  font-size: 15px;
                  font-weight: 100;
                "
                class="dropdown-item"
                [routerLink]="['junior']"
                >KidsKode Junior</a
              >
              <a
                style="
                  font-family: 'Montserrat', sans-serif;
                  font-size: 15px;
                  font-weight: 100;
                "
                class="dropdown-item"
                [routerLink]="['midlevel']"
                >Another action</a
              >
            </div>
          </li>
        </ul>
      </div>
    </div>
  </nav>
-->
  <div class="main">
    <header class="header" style="background-color: #ffffff">
      <h2
        style="
            position: absolute;
            margin-top: -26px;
            margin-left: 76px;
            font-family: 'Amatic SC';
            font-size: xxx-large;
            font-weight: revert;
          "
      >
        hello {{ username }} in your Dashboard !
      </h2>
    </header>
    <div id="child">
      <h3
        style="
            background-color: #ffffff;
            color: #f8de8d;
            margin-bottom: 5px;
            text-transform: uppercase;
            font-size: 20px;
            font-weight: 500;
          "
      >
        PARENT DASHBOARD
      </h3>
      <hr style="color: #f9cf0e; height: 5px; margin-bottom: 10px" />
      <div
        style="
            color: #f9cf0e;
            height: 3px;
            margin-bottom: -6px;
            background-color: #f9cf0e;
            margin-top: -17px;
          "
      ></div>

      <img class="lapin" src="/assets/aicha/avatarparent.png" alt="image" />
      <div class="userdetails child">
        <h4>
          <strong>Child Username</strong>
        </h4>
        <div *ngIf="parent">
          <h6>{{ parent.enfant.compte.username }}</h6>
        </div>
      </div>

      <h6 style="margin-left: 128px">
        <img
          style="height: 15px; width: 15px"
          ng-cdn-src="locales/warning.png"
          class="ng-isolate-scope"
          src="https://d2j5eocv5gptnv.cloudfront.net/assets/locales/warning-a16321f0719391db1dff87f5490b7e247fe4ff5f3968e99d41ba0c9dd143230b.png"
        />
        To start playing, log in to your childâ€™s account.
      </h6>
      <a routerLink="/Dashboard/child" class="button">Child </a>
    </div>
    <div style="width: 683px; height: 310px" id="box">
      <div
        style="
            background-color: #ffffff;
            display: block;
            height: 246px;
            width: 560px;
            margin-top: -33px;
            margin-left: 7px;
          "
        *ngIf="barChartData"
      >
        <canvas
          id="bar"
          height="300"
          width=" 550"
          baseChart
          class="chart"
          [datasets]="barChartData"
          [labels]="barChartLabels"
          [options]="barChartOptions"
          [chartType]="barChartType"
        >
        </canvas>
      </div>
    </div>
    <!-- <button type="button" class="button" (click)="btnClick()">
      Child Dashboard
    </button>-->
  </div>
</div>
</body>

<!--[legend]="barChartLegend"
-->
